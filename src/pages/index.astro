---
// --- Server Side (Static Shell) ---
export const prerender = true; 
---
//deploy

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Metalz-Calc</title>
    <style>
      :root { --bg: #f4f4f9; --card: #ffffff; --gold: #d4af37; --silver: #7f8c8d; --text: #333; --empty: #e0e0e0; }
      body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); padding: 20px; margin: 0; min-height: 100vh; display: flex; flex-direction: column; align-items: center; }
      
      .dashboard { width: 100%; max-width: 900px; display: flex; flex-direction: column; gap: 20px; }
      
      .card { background: var(--card); padding: 2rem; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.04); border: 1px solid rgba(0,0,0,0.05); }
      
      h1 { margin: 0; font-size: 2rem; text-align: center; color: #222; font-weight: 800; letter-spacing: -0.5px; }
      
      .badge-container { text-align: center; margin: 10px 0 25px 0; }
      .badge { display: inline-block; font-size: 0.85rem; font-weight: 600; color: #555; background: #fff; padding: 6px 16px; border-radius: 30px; border: 1px solid #e0e0e0; }
      .badge-sub { display: block; font-size: 0.7rem; color: #999; margin-top: 3px; font-weight: 400; }
      
      /* --- LAYOUT GRID --- */
      .calc-wrapper { display: flex; flex-direction: column; gap: 40px; }
      
      @media (min-width: 768px) {
        .calc-wrapper { display: grid; grid-template-columns: 1.2fr 1fr; align-items: center; gap: 40px; }
        .chart-col { border-left: 1px solid #eee; padding-left: 40px; min-height: 340px; display: flex; flex-direction: column; justify-content: center; }
      }

      .price-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px; }
      .price-item { background: #fafafa; padding: 15px; border-radius: 12px; text-align: center; border: 1px solid #eee; }
      .lbl { font-size: 0.7rem; text-transform: uppercase; font-weight: 700; color: #999; letter-spacing: 0.5px; margin-bottom: 4px; }
      .val { font-size: 1.4rem; font-weight: 700; color: #333; }
      .loading { color: transparent; background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%); background-size: 200% 100%; animation: shimmer 1.5s infinite; border-radius: 4px; display: inline-block; width: 80px; height: 1.4rem; }
      @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

      .input-group { margin-bottom: 20px; }
      .group-label { font-size: 0.95rem; font-weight: 600; margin-bottom: 8px; display: flex; align-items: center; gap: 8px; }
      .dot { width: 10px; height: 10px; border-radius: 50%; }
      .input-row { display: grid; grid-template-columns: 1.5fr 1fr; gap: 10px; }
      input { width: 100%; padding: 14px; border: 1px solid #e0e0e0; border-radius: 10px; font-size: 16px; box-sizing: border-box; background: #fff; -webkit-appearance: none; transition: border 0.2s; }
      input:focus { outline: none; border-color: #333; }
      
      .res-box { margin-top: 10px; font-size: 0.9rem; padding: 15px; background: #f8f9fa; border-radius: 10px; display: none; line-height: 1.5; border-left: 4px solid #ccc; }
      .res-box.visible { display: block; animation: slideDown 0.2s ease-out; }
      .up { color: #16a34a; font-weight: 700; }
      .down { color: #dc2626; font-weight: 700; }
      
      button { width: 100%; background: #222; color: #fff; border: none; padding: 16px; border-radius: 12px; font-size: 1.1rem; font-weight: 600; cursor: pointer; margin-top: 10px; transition: background 0.2s; }
      button:active { transform: scale(0.98); }
      
      /* --- CHART STYLES (Placeholder Mode) --- */
      .chart-col { display: flex; flex-direction: column; align-items: center; }
      
      .donut-chart { 
        position: relative; width: 220px; height: 220px; border-radius: 50%; 
        background: var(--empty); /* Default Grey */
        transition: background 0.8s cubic-bezier(0.4, 0.0, 0.2, 1);
        box-shadow: inset 0 0 20px rgba(0,0,0,0.03);
      }
      
      .donut-hole { position: absolute; top: 15px; left: 15px; width: 190px; height: 190px; background: var(--card); border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; }
      .total-lbl { font-size: 0.75rem; color: #999; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; }
      .total-val { font-size: 1.8rem; font-weight: 800; color: #bbb; margin-top: 2px; transition: color 0.3s; }
      .total-val.active { color: #333; }
      
      .legend { display: flex; gap: 20px; margin-top: 25px; }
      .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; font-weight: 600; color: #999; transition: color 0.3s; }
      .legend-item.active { color: #333; }
      .legend-val { font-weight: 400; color: #ccc; font-size: 0.85rem; margin-left: 4px; }
      .legend-item.active .legend-val { color: #666; }

      .footer-section { text-align: center; font-size: 0.75rem; color: #aaa; margin-top: 30px; line-height: 1.5; }
      @keyframes slideDown { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
  </head>
  <body>
    <div class="dashboard">
      <div class="card">
        <h1>Metalz-Calc</h1>
        
        <div class="badge-container">
          <div class="badge">
            <span id="dateText">Connecting...</span>
            <span id="nextUpdateText" class="badge-sub">Checking Live Prices</span>
          </div>
        </div>

        <div class="calc-wrapper">
          
          <div class="inputs-col">
            <div class="price-grid">
              <div class="price-item">
                <div class="lbl">Gold / oz</div>
                <div id="goldVal" class="val loading"></div>
              </div>
              <div class="price-item">
                <div class="lbl">Silver / oz</div>
                <div id="silverVal" class="val loading"></div>
              </div>
            </div>

            <div class="input-group">
              <div class="group-label"><div class="dot" style="background:var(--gold)"></div> Gold Holdings</div>
              <div class="input-row">
                <input type="number" step="0.01" id="goldOz" placeholder="Ounces" />
                <input type="number" id="goldYear" placeholder="Year Bought" min="1995" max="2026" />
              </div>
              <div id="goldRes" class="res-box"></div>
            </div>

            <div class="input-group">
              <div class="group-label"><div class="dot" style="background:var(--silver)"></div> Silver Holdings</div>
              <div class="input-row">
                <input type="number" step="0.01" id="silverOz" placeholder="Ounces" />
                <input type="number" id="silverYear" placeholder="Year Bought" min="1995" max="2026" />
              </div>
              <div id="silverRes" class="res-box"></div>
            </div>

            <button id="calcBtn">Calculate Value</button>
          </div>

          <div class="chart-col">
            <div class="donut-chart" id="donut">
              <div class="donut-hole">
                <span class="total-lbl">Total Net Worth</span>
                <span class="total-val" id="totalVal">---</span>
              </div>
            </div>
            <div class="legend">
              <div class="legend-item" id="lgItem">
                <div class="dot" style="background:var(--gold)"></div> 
                Gold <span id="goldPct" class="legend-val">--%</span>
              </div>
              <div class="legend-item" id="lsItem">
                <div class="dot" style="background:var(--silver)"></div> 
                Silver <span id="silverPct" class="legend-val">--%</span>
              </div>
            </div>
          </div>

        </div> </div>

      <div class="footer-section">
        Source: CoinGecko (Client-Side).<br/>
        <strong>EDUCATIONAL USE ONLY.</strong> Not financial advice.
      </div>
    </div>

    <script>
      const API_GOLD = "https://api.coingecko.com/api/v3/coins/pax-gold/market_chart?vs_currency=usd&days=1";
      const API_SILVER = "https://api.coingecko.com/api/v3/coins/kinesis-silver/market_chart?vs_currency=usd&days=1";

      let currentGold = 0;
      let currentSilver = 0;

      // 1. Fetch
      async function fetchData() {
        try {
          const [gRes, sRes] = await Promise.all([fetch(API_GOLD), fetch(API_SILVER)]);
          if (!gRes.ok || !sRes.ok) throw new Error("Limit");
          const gData = await gRes.json();
          const sData = await sRes.json();
          currentGold = gData.prices[gData.prices.length - 1][1];
          currentSilver = sData.prices[sData.prices.length - 1][1];
          updateUI(currentGold, currentSilver);
        } catch (e) {
          console.error(e);
          document.getElementById('dateText').innerText = "Offline Mode";
          currentGold = 5000; currentSilver = 100;
          updateUI(currentGold, currentSilver);
        }
      }

      function updateUI(g, s) {
        document.getElementById('goldVal').innerText = '$' + g.toLocaleString(undefined, {maximumFractionDigits:0});
        document.getElementById('silverVal').innerText = '$' + s.toLocaleString(undefined, {maximumFractionDigits:2});
        document.querySelectorAll('.loading').forEach(el => el.classList.remove('loading'));
        
        const now = new Date();
        document.getElementById('dateText').innerText = `Live: ${now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}`;
        document.getElementById('nextUpdateText').innerText = now.toLocaleDateString();
      }

      // 2. Calculator Logic
      document.getElementById('calcBtn').addEventListener('click', () => {
        const gTotal = runCalc('gold', currentGold);
        const sTotal = runCalc('silver', currentSilver);
        
        // Always update chart, even if 0 (to show empty state)
        updateChart(gTotal, sTotal);
      });

      function updateChart(gVal, sVal) {
        const total = gVal + sVal;
        const totalEl = document.getElementById('totalVal');
        
        if (total > 0) {
          // ACTIVE STATE
          totalEl.innerText = '$' + total.toLocaleString(undefined, {maximumFractionDigits:0});
          totalEl.classList.add('active');
          document.getElementById('lgItem').classList.add('active');
          document.getElementById('lsItem').classList.add('active');

          const gPct = (gVal / total) * 100;
          
          document.getElementById('goldPct').innerText = Math.round(gPct) + '%';
          document.getElementById('silverPct').innerText = Math.round(100 - gPct) + '%';

          const donut = document.getElementById('donut');
          donut.style.background = `conic-gradient(var(--gold) 0% ${gPct}%, var(--silver) ${gPct}% 100%)`;
        } else {
          // EMPTY STATE (Reset)
          totalEl.innerText = '$0';
          totalEl.classList.remove('active');
          document.getElementById('lgItem').classList.remove('active');
          document.getElementById('lsItem').classList.remove('active');
          document.getElementById('donut').style.background = 'var(--empty)';
          document.getElementById('goldPct').innerText = '--%';
          document.getElementById('silverPct').innerText = '--%';
        }
      }

      const historyDB = {
        1995: { gold: 384, silver: 5.20 }, 1996: { gold: 387, silver: 5.19 },
        1997: { gold: 331, silver: 4.89 }, 1998: { gold: 294, silver: 5.54 },
        1999: { gold: 278, silver: 5.22 }, 2000: { gold: 279, silver: 4.95 },
        2001: { gold: 271, silver: 4.37 }, 2002: { gold: 310, silver: 4.60 },
        2003: { gold: 363, silver: 4.85 }, 2004: { gold: 409, silver: 6.66 },
        2005: { gold: 444, silver: 7.31 }, 2006: { gold: 603, silver: 11.55 },
        2007: { gold: 695, silver: 13.38 }, 2008: { gold: 871, silver: 14.99 },
        2009: { gold: 972, silver: 14.67 }, 2010: { gold: 1224, silver: 20.19 }, 
        2011: { gold: 1571, silver: 35.12 }, 2012: { gold: 1668, silver: 31.15 }, 
        2013: { gold: 1411, silver: 23.79 }, 2014: { gold: 1266, silver: 19.08 }, 
        2015: { gold: 1160, silver: 15.68 }, 2016: { gold: 1250, silver: 17.14 }, 
        2017: { gold: 1257, silver: 17.04 }, 2018: { gold: 1268, silver: 15.71 }, 
        2019: { gold: 1392, silver: 16.21 }, 2020: { gold: 1769, silver: 20.55 }, 
        2021: { gold: 1798, silver: 25.14 }, 2022: { gold: 1801, silver: 21.76 }, 
        2023: { gold: 1940, silver: 23.35 }, 2024: { gold: 2350, silver: 28.50 }, 
        2025: { gold: 2650, silver: 32.00 }, 2026: { gold: 0, silver: 0 }
      };

      function runCalc(type, price) {
        const ozEl = document.getElementById(type+'Oz');
        const yearEl = document.getElementById(type+'Year');
        const resEl = document.getElementById(type+'Res');
        const oz = parseFloat(ozEl.value);
        
        if (!oz) { 
          resEl.classList.remove('visible'); 
          return 0; 
        }

        const total = oz * price;
        const totalStr = total.toLocaleString(undefined, {minimumFractionDigits: 2});
        
        let html = `<div>Value: <strong>$${totalStr}</strong></div>`;

        const year = yearEl.value;
        if (year && historyDB[year]) {
          const buyPrice = historyDB[year][type] || price;
          const cost = oz * buyPrice;
          const diff = total - cost;
          const isUp = diff >= 0;
          const pct = ((diff / cost) * 100).toFixed(1);
          html += `<div style="font-size:0.85em;color:#666;margin-top:5px">History: Bought ${year}</div>`;
          html += `<div style="margin-top:2px;font-weight:600;">${isUp?'Profit':'Loss'}: <span class="${isUp?'up':'down'}">${isUp?'+':'-'}$${Math.abs(diff).toLocaleString(undefined,{minimumFractionDigits:2})} (${pct}%)</span></div>`;
        }
        resEl.innerHTML = html;
        resEl.classList.add('visible');
        return total;
      }

      fetchData();
    </script>
  </body>
</html>